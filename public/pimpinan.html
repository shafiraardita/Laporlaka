<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistem Monitoring - Pimpinan</title>
    <!-- üü° Tambahkan favicon -->
    <link rel="icon" type="image/png" href="assets/Logo.svg" />
    <link rel="stylesheet" href="styles/admin.css">
    <link rel="stylesheet" href="styles/responsive.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.29/jspdf.plugin.autotable.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <img src="https://img.icons8.com/ios-filled/50/000000/pdf.png" alt="Download PDF" style="width: 28px; height: 28px;" />
    <script src="https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY&libraries=geometry,drawing&callback=initMap" async defer></script>
</head>
<body>
    <body>
    <header class="header">
  <button id="collapseSidebar" class="collapse-btn text-[#375B85] text-2xl p-2">
    ‚ò∞
  </button>
        <div class="user-info">
<button class="logout-btn" onclick="handleLogout()">Keluar</button>
<span class="user-name">Pengguna: <span id="username">Pimpinan</span></span>
</div>
</header>

    <div class="sidebar">
  <div id="sidebar-profile-btn" class="sidebar-header flex items-center justify-start gap-2 p-3 cursor-pointer">
  <img id="sidebar-profile-icon" src="assets/user.png" alt="Profile Icon" class="profile-icon w-8 h-8">
  <span class="sidebar-title font-semibold text-[#375B85]">admin</span>
  </div>

  <nav class="sidebar-nav flex flex-col gap-2 mt-2">
    <a href="#home" class="nav-item flex items-center gap-3 px-4 py-2" data-section="home-section">
      <i class="fas fa-home w-5 text-[#375B85]"></i>
      <span class="nav-text">Beranda</span>
    </a>
    <a href="#laporan-masuk" class="nav-item flex items-center gap-3 px-4 py-2" data-section="laporan-masuk-section">
      <i class="fas fa-inbox w-5 text-[#375B85]"></i>
      <span class="nav-text">Laporan Masuk</span>
    </a>
    <a href="#monitoring" class="nav-item flex items-center gap-3 px-4 py-2" data-section="monitoring-section">
      <i class="fas fa-chart-line w-5 text-[#375B85]"></i>
      <span class="nav-text">Monitoring Data</span>
    </a>
    <a href="#titik-laporan" class="nav-item flex items-center gap-3 px-4 py-2" data-section="titik-laporan-section">
      <i class="fas fa-map-marker-alt w-5 text-[#375B85]"></i>
      <span class="nav-text">Titik Laporan</span>
    </a>
    <a href="#tracking" class="nav-item flex items-center gap-3 px-4 py-2" data-section="tracking-section">
      <i class="fas fa-route w-5 text-[#375B85]"></i>
      <span class="nav-text">Pelacakan Laporan</span>
    </a>
  </nav>
</div>

    <main class="main-content">
        <section id="home-section" class="content-section">
            <h2>Selamat datang, Pimpinan!</h2>
            <div class="section-content">
                <p>Anda telah masuk ke Sistem Monitoring & Evaluasi Kecelakaan Lalu Lintas Kota Bogor.</p>
                <p>Silahkan pantau data kecelakaan secara real-time dan kelola informasi dengan bijak untuk mendukung pengambilan keputusan yang tepat.</p>
                <p>Pilih menu sidebar untuk melihat detail</p>
                <div class="stats-section">
                    <h3>Proses Pelaporan</h3>
                    <div class="stats-cards">
                        <div class="stats-card proses1">
                            <h4>Total Laporan</h4>
                            <p id="total-laporan">0</p>
                        </div>
                        <div class="stats-card proses2">
                            <h4>Kasus Dalam Proses</h4>
                            <p id="kasus-proses">0</p>
                        </div>
                        <div class="stats-card proses3">
                            <h4>Kasus Diselesaikan</h4>
                            <p id="kasus-selesai">0</p>
                        </div>
                    </div>
                </div>
                <div class="notification-section">
                    <h3>Laporan Terbaru</h3>
                    <div class="notification-list" id="notification-list"></div>
                </div>
                <div class="evaluasi-section">
                    <h3>Evaluasi</h3>
                    <p>Evaluasi data kecelakaan lalu lintas untuk meningkatkan keselamatan.</p>
                    <div class="evaluasi-cards" id="evaluasi-cards"></div>
                </div>
            </div>
        </section>

        <section id="profil-section" class="content-section">
            <h2>Profil Pengguna</h2>
            <div class="section-content profile-section">
                <div class="profile-field">
                    <label>Foto Profil:</label>
                    <img id="profile-preview" src="assets/user.png" alt="Profile Preview" style="max-width: 100px; margin-top: 10px;">
                </div>
                <div class="profile-field">
                    <label>Nama:</label>
                    <input type="text" id="profil-username" value="Pimpinan">
                </div>
                <div class="profile-field">
                    <label>Email:</label>
                    <input type="email" id="profil-email" value="">
                </div>
                <div class="profile-field">
                    <label>NIK:</label>
                    <input type="text" id="profil-nik" value="">
                </div>
                <div class="profile-field">
                    <label>Jabatan:</label>
                    <input type="text" id="profil-jabatan" value="">
                </div>
                <div class="profile-field">
                    <label>Nomor Telepon:</label>
                    <input type="tel" id="profil-telepon" value="">
                </div>
                <div class="profile-buttons">
                    <button class="save-btn" id="save-profile-btn">Simpan</button>
                </div>
            </div>
        </section>


        <section id="monitoring-section" class="content-section">
            <h2>Monitoring Data Kecelakaan Lalu Lintas di Kota Bogor</h2>
            <div class="section-content">
                <div class="monitoring-filters">
                    <label for="year-select">Tahun:</label>
                    <select id="year-select">
                        <option value="2023">2023</option>
                        <option value="2024">2024</option>
                        <option value="2025">2025</option>
                    </select>
                    <select id="month-select" onchange="updateChart()">
                    <option value="all">Semua Bulan</option>
                    <option value="01">Januari</option>
                    <option value="02">Februari</option>
                    <option value="03">Maret</option>
                    <option value="04">April</option>
                    <option value="05">Mei</option>
                    <option value="06">Juni</option>
                    <option value="07">Juli</option>
                    <option value="08">Agustus</option>
                    <option value="09">September</option>
                    <option value="10">Oktober</option>
                    <option value="11">November</option>
                    <option value="12">Desember</option>
                    </select>
                </div>
                <div class="chart-wrapper" id="chart-container">
                <canvas id="accident-chart"></canvas>
                <div class="monitoring-buttons">
                <button class="download-btn" id="download-chart-btn">Unduh Gambar</button>
                <button class="download-btn" id="download-excel-btn">Unduh Excel</button>
            </div>
            </div>

            </div>
        </section>

        <!-- Titik laporan -->
<div class="content-section" id="titik-laporan-section">
  <h2>Titik Laporan Kecelakaan di Kota Bogor</h2>
  <p>Halaman ini menampilkan titik laporan kecelakaan berdasarkan tahun yang dipilih.</p>

  <!-- Filter monitoring -->
  <div class="filter-section">
    <label for="filter-tahun-laporan">Pilih Tahun:</label>
    <select id="filter-tahun-laporan" onchange="toggleMapByYear()">
      <option value="2023">2023</option>
      <option value="2024">2024</option>
      <option value="2025" selected>2025</option>
    </select>
  </div>

  <!-- Tombol Unduh di bawah dropdown -->
  <div class="download-buttons">
    <button class="map-download-btn" onclick="downloadSelectedMapImage()">üñºÔ∏è Unduh Gambar Peta</button>
    <button class="map-download-btn" onclick="downloadSelectedMapExcel()">üìä Unduh Data Excel</button>
  </div>

  <!-- Map Container -->
  <div id="map-2023" style="height: 400px; width: 100%; display:none;"></div>
  <div id="map-2024" style="height: 400px; width: 100%; display:none;"></div>
  <div id="map-2025" style="height: 400px; width: 100%;"></div>
</div>

<!-- ================= MODAL DETAIL LAPORAN (PIMPINAN) ================= -->
<div class="modal" id="report-modal" style="display: none;">
  <div class="modal-content">
    <span class="modal-close" onclick="closeModal()">√ó</span>
    <h2>Detail Laporan</h2>

    <!-- ============ DATA PELAPOR ============ -->
    <div class="modal-section">
      <h3>Data Pelapor</h3>
      <div class="modal-grid-2">
        <div class="form-group">
          <label>Nama:</label>
          <span id="report-nama">-</span>
        </div>
        <div class="form-group">
          <label>NIK:</label>
          <span id="report-nik">-</span>
        </div>
        <div class="form-group">
          <label>Email:</label>
          <span id="report-email">-</span>
        </div>
        <div class="form-group">
          <label>Telepon:</label>
          <span id="report-telepon">-</span>
        </div>
        <div class="form-group full-width">
          <label>Saksi:</label>
          <span id="report-saksi">-</span>
        </div>
      </div>
    </div>

    <!-- ============ DATA KORBAN / LAPORAN ============ -->
    <div class="modal-section">
      <h3>Data Kecelakaan</h3>
      <div class="modal-grid-2">
        <div class="form-group">
          <label>Jenis Kecelakaan:</label>
          <span id="report-jenis">-</span>
        </div>
        <div class="form-group">
          <label>Kendaraan:</label>
          <span id="report-kendaraan">-</span>
        </div>
        <div class="form-group">
          <label>Jumlah Korban:</label>
          <span id="report-jumlah-korban">-</span>
        </div>
        <div class="form-group">
          <label>Titik Kejadian:</label>
          <span id="report-titik">-</span>
        </div>
        <div class="form-group">
          <label>Tanggal:</label>
          <span id="report-tanggal">-</span>
        </div>
        <div class="form-group">
          <label>Status:</label>
          <span id="report-status">-</span>
        </div>
      </div>

      <div class="form-group full-width">
        <label>Bukti Kecelakaan:</label>
        <img id="report-bukti" src="" alt="Bukti Kecelakaan"
          style="max-width: 100%; border-radius: 8px; border: 1px solid #ccc; margin-top: 5px;">
      </div>

      <div class="form-group full-width">
        <label>Kronologi:</label>
        <p id="report-kronologi" class="text-area-view">-</p>
      </div>
    </div>
<!-- ================= DATA PETUGAS ================= -->
<!-- === Data Petugas === -->
<div class="modal-section">
  <h3>Data Petugas</h3>
  <div class="modal-grid-2">
    <div class="form-group full-width">
      <label>Nama Petugas:</label>
      <span id="report-petugas">-</span>
    </div>

    <div class="form-group full-width">
      <label>Bukti Selesai:</label>
      <img id="report-foto-petugas" src="" alt="Bukti Selesai"
           style="max-width: 100%; border-radius: 8px; margin-top: 5px; display: none;" />
    </div>

    <div class="form-group full-width">
      <label>Keterangan Selesai:</label>
      <p id="report-keterangan" class="text-area-view">-</p>
    </div>
  </div>
</div>
    <div class="report-buttons" style="text-align: right;">
      <button class="btn cancel-btn" onclick="closeModal()">Tutup</button>
    </div>
  </div>
</div>


<section id="laporan-masuk-section" class="content-section">
    <h2>Laporan Masuk</h2>
    <div class="section-content">
    <p>Halaman ini menampilkan laporan kecelakaan yang telah masuk ke sistem.</p>
    <div class="filter-bar">
    <label for="report-search">Cari ID atau Nama Laporan:</label>
    <input type="text" id="report-search" oninput="searchReportById()" placeholder="Masukkan ID atau Nama">
    <label for="year-filter">Tahun:</label>
    <select id="year-filter">
        <option value="all">Semua</option>
        <option value="2025">2025</option>
        <option value="2024">2024</option>
        <option value="2023">2023</option>
    </select>

    <label for="month-filter">Bulan:</label>
    <select id="month-filter">
        <option value="all">Semua</option>
        <option value="Januari">Januari</option>
        <option value="Februari">Februari</option>
        <option value="Maret">Maret</option>
        <option value="April">April</option>
        <option value="Mei">Mei</option>
        <option value="Juni">Juni</option>
        <option value="Juli">Juli</option>
        <option value="Agustus">Agustus</option>
        <option value="September">September</option>
        <option value="Oktober">Oktober</option>
        <option value="November">November</option>
        <option value="Desember">Desember</option>
    </select>

    <button id="download-filter-btn"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
    <path d="M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5z"/>
    <path d="M7.646 11.854a.5.5 0 0 0 .708 0l3-3a.5.5 0 0 0-.708-.708L8.5 10.293V1.5a.5.5 0 0 0-1 0v8.793L5.354 8.146a.5.5 0 1 0-.708.708l3 3z"/>
    </svg>Unduh Filter</button>
</div>
<table id="report-table" class="user-table">
<thead>
    <tr>
      <th>ID</th>
      <th>Nama</th>
      <th>Tanggal</th>
      <th>Jenis</th>
      <th>Titik kecelakaan</th>
      <th>Saksi</th>
      <th>Kronologi</th>
      <th>Status</th>
      <th>Detail</th>
      <th>Unduh</th>
    </tr>
  </thead>
  <tbody id="report-table-body"></tbody>
</table>
<div class="pagination-center">
    <button id="prev-page">Kembali</button>
    <button id="next-page">Lanjut</button>
</div>
</div>
</section>
        
        <section id="tracking-section" class="content-section">
    <h2>Pelacakan Laporan Kecelakaan</h2>
    <div class="section-content">
        <div class="stats-section">
            <div class="stats-cards">
                <div class="stats-card blue1">
                    <h4>Total Laporan</h4>
                    <p id="total-reports">0</p>
                </div>
                <div class="stats-card blue2">
                    <h4>Laporan Diterima</h4>
                    <p id="accepted-reports-count">0</p>
                </div>
                <div class="stats-card blue3">
                    <h4>Penanganan Laporan</h4>
                    <p id="handling-reports-count">0</p>
                </div>
                <div class="stats-card blue4">
                    <h4>Laporan Selesai</h4>
                    <p id="received-data-count">0</p>
                </div>
                <div class="stats-card blue5">
                    <h4>Laporan Ditolak</h4>
                    <p id="rejected-reports-count">0</p>
                </div>
            </div>
        </div>
        <div class="tracking-filter-bar">
  <input type="text" id="tracking-search" placeholder="Cari berdasarkan ID atau Nama" oninput="searchTracking()" />
  <select id="tracking-year" onchange="applyFilters()">
  <option value="all">Semua Tahun</option>
  <option value="2025">2025</option>
  <option value="2024">2024</option>
  <option value="2023">2023</option>
</select>

<select id="tracking-month" onchange="applyFilters()">
  <option value="all">Semua Bulan</option>
  <option value="Januari">Januari</option>
  <option value="Februari">Februari</option>
  <option value="Maret">Maret</option>
  <option value="April">April</option>
  <option value="Mei">Mei</option>
  <option value="Juni">Juni</option>
  <option value="Juli">Juli</option>
  <option value="Agustus">Agustus</option>
  <option value="September">September</option>
  <option value="Oktober">Oktober</option>
  <option value="November">November</option>
  <option value="Desember">Desember</option>
</select>
  <button onclick="downloadFilteredTracking(currentTrackingCategory)"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
    <path d="M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5z"/>
    <path d="M7.646 11.854a.5.5 0 0 0 .708 0l3-3a.5.5 0 0 0-.708-.708L8.5 10.293V1.5a.5.5 0 0 0-1 0v8.793L5.354 8.146a.5.5 0 1 0-.708.708l3 3z"/>
    </svg>Unduh Filter</button>
</div>
<div class="tracking-categories">
    <div class="category-card active" data-category="all" onclick="filterCategory('all')">Semua Laporan</div>
    <div class="category-card" data-category="accepted" onclick="filterCategory('accepted')">Laporan Diterima</div>
    <div class="category-card" data-category="handling" onclick="filterCategory('handling')">Penanganan Laporan</div>
    <div class="category-card" data-category="received" onclick="filterCategory('received')">Laporan Selesai</div>
    <div class="category-card" data-category="rejected" onclick="filterCategory('rejected')">Laporan Ditolak</div>
</div>
<div class="table-card">
<table id="tracking-table">
    <thead>
        <tr>
            <th>ID</th>
            <th>Nama</th>
            <th>Tanggal</th>
            <th>Jenis Kecelakaan</th>
            <th>Kendaraan</th>
            <th>Jumlah Korban</th>
            <th>Titik Kejadian</th>
            <th>Kronologi</th>
            <th>Detail</th>
            <th>Status</th>
        </tr>
    </thead>
    <tbody id="tracking-table-body"></tbody>
</table>
</div>
    <div class="pagination"><div>
    <button id="prev-page">Kembali</button>
    <button id="next-page">Lanjut</button>
</div>
        </div>
        </div>
    </div>
</section>

        <!-- Modal for Report Details -->
        <div class="modal" id="report-modal" style="display: none;">
    <div class="modal-content">
        <span class="modal-close">√ó</span>
        <h2>Detail Laporan</h2>
        <div class="modal-body">
            <p><strong>Nama:</strong> <span id="report-nama" class="readonly-field"></span></p>
            <p><strong>NIK:</strong> <span id="report-nik" class="readonly-field"></span></p>
            <p><strong>Email:</strong> <span id="report-email" class="readonly-field"></span></p>
            <p><strong>Telepon:</strong> <span id="report-telepon" class="readonly-field"></span></p>
            <p><strong>Saksi:</strong> <span id="report-saksi" class="readonly-field"></span></p>
            <p><strong>Titik Kecelakaan:</strong> <span id="report-titik" class="readonly-field"></span></p>
            <p><strong>Kendaraan yang Terlibat:</strong> <span id="report-kendaraan" class="readonly-field"></span></p>
            <p><strong>Jenis Kecelakaan:</strong> <span id="report-jenis" class="readonly-field"></span></p>
            <p><strong>Jumlah Korban:</strong> <span id="report-jumlah-korban" class="readonly-field"></span></p>
            <p><strong>Tanggal:</strong> <span id="report-tanggal" class="readonly-field"></span></p>
            <p><strong>Status:</strong> <span id="report-status" class="readonly-field"></span></p>
            <p><strong>Petugas:</strong> 
            <input type="text" id="report-petugas" value="" readonly style="pointer-events: none;" />
            </p>
            <p><strong>Bukti:</strong> 
                <img id="report-bukti" src="" alt="Bukti Kecelakaan" style="max-width: 200px; border: 1px solid #ccc;">
            </p>
            <p><strong>Kronologi kecelakaan:</strong> 
                <span id="report-kronologi" class="readonly-field" style="display: block; white-space: pre-wrap;"></span>
            </p>
        </div>
        <div class="report-buttons"></div>
    </div>
</div>
        <!-- Modal for Evaluasi -->
        <div id="modal-overlay"></div>
        <div class="modal" id="evaluasi-modal" style="display: none;">
            <div class="modal-content">
                <span class="modal-close">√ó</span>
                <h2>Ubah Evaluasi</h2>
                <div class="modal-body">
                    <div class="profile-field">
                        <label>Judul:</label>
                        <input type="text" id="evaluasi-title" value="">
                    </div>
                    <div class="profile-field">
                        <label>Deskripsi:</label>
                        <textarea id="evaluasi-description"></textarea>
                    </div>
                    <div class="profile-field">
                        <label>Periode:</label>
                        <input type="text" id="evaluasi-period" value="">
                    </div>
                </div>
                <div class="profile-buttons">
                    <button class="cancel-btn" id="cancel-evaluasi-btn">Batal</button>
                </div>
            </div>
        </div>

    <!-- Include the external JavaScript file -->
    <script src="scripts/pimpinan.js"></script>
</body>
</html>
<script>
    document.addEventListener("DOMContentLoaded", function () {
  const collapseBtn = document.getElementById("collapseSidebar");
  const sidebar = document.querySelector(".sidebar");
  const overlay = document.createElement("div");
  overlay.className = "sidebar-overlay";
  document.body.appendChild(overlay);

  if (collapseBtn && sidebar) {
    collapseBtn.addEventListener("click", () => {
      if (window.innerWidth > 768) {
        sidebar.classList.toggle("collapsed");
      } else {
        sidebar.classList.toggle("active");
        overlay.classList.toggle("active");
      }
    });

    overlay.addEventListener("click", () => {
      sidebar.classList.remove("active");
      overlay.classList.remove("active");
    });
  }
});
</script>
